<div class="container py-4">
 
  <!-- Loading state -->
  @if (transactionService.loading()) {
    <div class="d-flex justify-content-center my-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading transactions...</span>
      </div>
    </div>
  }
  
  <!-- Error state -->
  @if (transactionService.error()) {
    <div class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>{{ transactionService.error() }}
      <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadTransactions()">Retry</button>
    </div>
  }
  
  <!-- Transactions table -->
  @if (transactionService.transactions().length > 0) {
    <div class="card shadow-sm mb-3">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table mb-0">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Description</th>
                <th>Direction</th>
                <th>Account</th>
                <th class="text-end">Amount</th>
                <th>Date</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (transaction of transactionService.transactions(); track transaction.id) {
                <tr>
                  <td class="text-muted small">{{ transaction.id }}</td>
                  <td>{{ transaction.description || 'No description' }}</td>
                  <td>
                    @if (transaction.amount && transaction.amount > 0) {
                      <span class="badge bg-success">Income</span>
                    } @else if (transaction.amount && transaction.amount < 0) {
                      <span class="badge bg-danger">Expense</span>
                    } @else {
                      <span class="badge bg-secondary">Unknown</span>
                    }
                  </td>
                  <td>{{ transaction.accountName || 'Unknown Account' }}</td>
                <td class="text-end" [ngClass]="{'text-success': (transaction.amount || 0) > 0, 'text-danger': (transaction.amount || 0) < 0}">
                {{ transaction.amount | currency }}
                </td>
                  <td>{{ transaction.date | date:'short' }}</td>
                  <td class="text-center">
                    <button type="button" class="btn btn-sm btn-outline-danger" (click)="openDeleteConfirmation(transaction, deleteConfirmationModal)">
                    <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Pagination controls -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <span class="me-2">Showing {{ (transactionService.currentPage() - 1) * transactionService.pageSize() + 1 }} 
          to {{ Math.min(transactionService.currentPage() * transactionService.pageSize(), transactionService.totalItems()) }} 
          of {{ transactionService.totalItems() }} transactions</span>
          
        <select class="form-select form-select-sm d-inline-block w-auto" 
                [value]="transactionService.pageSize()"
                (change)="changePageSize($event)">
          @for (size of pageSizes; track size) {
            <option [value]="size">{{ size }} per page</option>
          }
        </select>
      </div>
      
      <nav aria-label="Transaction pagination">
        <ul class="pagination mb-0">
          <li class="page-item" [class.disabled]="transactionService.currentPage() === 1">
            <button class="page-link" (click)="previousPage()" [disabled]="transactionService.currentPage() === 1">
              <i class="bi bi-chevron-left"></i>
            </button>
          </li>
          
          @for (page of getPageNumbers(); track page) {
            @if (page > 0) {
              <li class="page-item" [class.active]="page === transactionService.currentPage()">
                <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
              </li>
            } @else {
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
            }
          }
          
          <li class="page-item" [class.disabled]="transactionService.currentPage() === transactionService.totalPages()">
            <button class="page-link" (click)="nextPage()" [disabled]="transactionService.currentPage() === transactionService.totalPages()">
              <i class="bi bi-chevron-right"></i>
            </button>
          </li>
        </ul>
      </nav>
    </div>
    
  }
</div>

<ng-template #deleteConfirmationModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="modal-delete-title">Confirm Delete</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    @if (transactionToDelete) {
      <p>Are you sure you want to delete this transaction?</p>
      <div class="mb-3">
        <strong>Description:</strong> {{ transactionToDelete.description || 'No description' }}
      </div>
      <div class="mb-3">
        <strong>Amount:</strong> 
        <span [ngClass]="{'text-success': (transactionToDelete.amount || 0) > 0, 'text-danger': (transactionToDelete.amount || 0) < 0}">
        {{ transactionToDelete.amount | currency }}
        </span>
      </div>
      <div class="mb-3">
        <strong>Date:</strong> {{ transactionToDelete.date | date:'short' }}
      </div>
      <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle me-2"></i>This action cannot be undone.
      </div>
    }
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-danger" 
            [disabled]="transactionService.loading()" 
            (click)="modal.close('confirm')">
      @if (transactionService.loading()) {
        <span class="spinner-border spinner-border-sm me-2"></span>
      }
      Delete
    </button>
  </div>
</ng-template>